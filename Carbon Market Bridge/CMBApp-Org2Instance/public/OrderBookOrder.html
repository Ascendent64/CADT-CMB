<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order-Book Market</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            display: flex;
            flex-direction: column;
        }
    
        h1 {
            text-align: center;
        }
    
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: darkgreen;
            color: white;
            padding: 10px;
        }

        .count-green {
            color: #00a300; 
            font-weight: bold;
        }
    
        .client-id-box {
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            background-color: #f9f9f9;
            color: black;
            display: flex;
            align-items: center;
        }

        .grey-box {
            padding: 20px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        
    
        .settings-button {
            cursor: pointer;
            margin-left: 10px;
            background-color: white;
            color: darkgreen;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
        }
    
        .nav-bar {
            display: flex;
            justify-content: center;
            background-color: darkgreen;
            padding: 10px;
        }
    
        .nav-bar a {
            color: white;
            padding: 14px 20px;
            text-decoration: none;
            text-align: center;
        }
    
        .nav-bar a:hover {
            background-color: #dddddd;
            color: black;
        }
    
        .content {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }
    
        .input-group {
            margin-bottom: 20px;
        }
    
        .input-group label {
            display: inline-block;
            width: 250px;
        }
    
        .input-group input {
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    
        .input-group .error {
            color: red;
            margin-left: 10px;
        }
    
        .coefficient-group {
            margin-bottom: 10px;
        }
    
        .slider-container {
            display: none;
            align-items: center;
            margin-bottom: 5px;
        }
    
        .slider-container label {
            width: 200px;
            text-align: right;
            margin-right: 10px;
        }
    
        .slider {
            width: 300px;
            margin: 0 5px;
            height: 10px;
        }
    
        .output-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }
    
        .output {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
            font-size: 1rem;
            overflow-wrap: break-word;
        }
    
        .slider-value {
            margin-left: 10px;
        }
    
        .checkbox-container {
            display: inline-flex;
            align-items: center;
            margin-right: 15px;
            margin-bottom: 5px;
        }
    
        .checkbox-container input[type="checkbox"] {
            accent-color: darkgreen;
        }
    
        .dropdown-container {
            margin-bottom: 20px;
        }
    
        .dropdown-container select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
            color: black;
        }
    
        .dropdown-container select:focus {
            outline: none;
            border-color: darkgreen;
        }
    
        .dropdown-container option {
            color: black;
        }
    
        .dropdown-container option:checked {
            background-color: darkgreen;
            color: white;
        }
    
        .order-type-container {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
    
        .order-type-container label {
            margin-right: 10px;
        }
    
        .order-type-container input[type="checkbox"],
        .order-type-container input[type="radio"] {
            margin-right: 5px;
            accent-color: darkgreen;
        }
    
        .submit-button-container {
            margin-top: 20px;
        }
    
        .submit-button {
            padding: 10px 20px;
            background-color: darkgreen;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    
        .tokens-list {
            margin-bottom: 20px;
        }
    
        .tokens-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
    
        .tokens-table th,
        .tokens-table td {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: left;
        }
    
        .tokens-table tr:nth-child(even) td,
        .tokens-table tr:nth-child(odd) td {
            background-color: #ffffff; 
        }
    
        .tokens-table .second-header {
            background-color: #f2f2f2 !important;
            color: black;
            font-weight: bold;
        }
    
        .tokens-table th {
            background-color: #f2f2f2; 
            font-weight: bold;
            text-align: left;
            border: 1px solid #ddd;
        }
    
        .main-header {
            background-color: #f2f2f2;
            font-weight: bold;
        }
    
        .green-bg {
            background-color: #e0f7e0 !important;
        }
    
        .orange-bg {
            background-color: #ffe6cc !important;
        }
    
        .tooltip {
            position: relative;
            display: inline-block;
        }
    
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: #f9f9f9;
            color: #333;
            text-align: left;
            border-radius: 5px;
            padding: 10px;
            border: 1px solid #ddd;
            position: absolute;
            z-index: 1;
            top: 100%;
            left: 0;
            margin-left: -10px;
        }

        .background-red {
            background-color: #f8d7da !important;
            color: black !important; 
        }


        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    
        .log-box {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
            background-color: #f9f9f9;
        }
    
        .log-item {
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    
        .price-difference-positive {
            color: #00a300;
            font-weight: bold;
        }
    
        .price-difference-negative {
            color: #ff0000;
            font-weight: bold;
        }
    
        .market-summary {
            padding: 20px;
            background-color: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 5px;
            text-align: center;
            margin-bottom: 20px;
        }
    
        .market-summary h2 {
            margin: 0;
            font-size: 2rem;
        }
    
        .market-summary .total-listed-units {
            font-size: 3rem;
            color: darkgreen;
            font-weight: bold;
        }
    
        .icon {
            width: 16px;
            height: 16px;
            cursor: pointer;
            vertical-align: middle;
            margin-left: 5px;
        }


        .tokens-table th.black-border {
            border: 2px solid black !important;
        }

        #popup {
            position: fixed;
            top: 200px; 
            right: 20px;
            padding: 10px;
            background-color: transparent; 
            border-radius: 5px;
            display: none;
            z-index: 9999;
            font-family: Arial, sans-serif;
            cursor: pointer;
            max-width: 500px;
            word-wrap: break-word; 
        }
        .message-box {
            background-color: darkgreen;
            color: white;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 5px;
            border: 2px solid white; 
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }



    </style>
    
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="regions.js"></script>
    <script type="text/javascript">
        let mainTokensList = []; 
        let fullClientID = '';



        const ws = new WebSocket('ws://localhost:4000');
            ws.onmessage = function (event) {
                const maxLength = 100; 
                const message = event.data.length > maxLength ? event.data.slice(0, maxLength) + '...' : event.data;

                const popup = document.getElementById('popup');
                const newMessageBox = document.createElement('div');
                newMessageBox.classList.add('message-box');

                newMessageBox.innerText = message;

                popup.appendChild(newMessageBox); 
                popup.style.display = 'block';

                setTimeout(() => {
                    if (newMessageBox) {
                        popup.removeChild(newMessageBox);
                    }
                    if (!popup.hasChildNodes()) {
                        popup.style.display = 'none'; 
                    }
                }, 3000);
            };

            ws.onopen = function () {
                console.log('WebSocket connection established.');
            };

            ws.onclose = function () {
                console.log('WebSocket connection closed.');
            };


        $(document).ready(function () {
            sliders = document.querySelectorAll('.slider');
            function updateVisibilityBasedOnOrderType() {
                const isInformationDependent = $('#order-type-information-dependent').is(':checked');
                $('.coefficient-group, .dropdown-container').css('display', isInformationDependent ? 'block' : 'none');
                $('#regression-equation').css('display', isInformationDependent ? 'block' : 'none');
                validateInputs();
                updateCounts(mainTokensList); 
            }

            $('#sector-dropdown').on('change', function () {
                updateSectorSliders();
                updateCounts(mainTokensList); 
            });

            $('#order-type-information-agnostic, #order-type-information-dependent').on('change', function () {
                updateVisibilityBasedOnOrderType();
            });

            $('.checkbox-container input').on('change', function () {
                updateCounts(mainTokensList); 
            });

            $('.checkbox-container').hover(function () {
                const region = $(this).find('label').text().trim();
                const tooltipTextElement = $(this).find('.tooltiptext');

                if (regionCountries[region]) {
                    const countryList = regionCountries[region].join(', ');
                    tooltipTextElement.html(countryList);
                } else {
                    logMessage("No country data found for region: " + region);
                    tooltipTextElement.html('No country data available');
                }
            });

            updateSectorSliders();
            toggleSliderContainers();
            updateVisibilityBasedOnOrderType();
            listAllTokens(); 

            $('#sector-dropdown, .checkbox-container input').on('change', fetchAndFilterTokens); 
        });

        function logMessage(message) {
            const logBox = document.getElementById('log-box');
            if (logBox) {
                const logItem = document.createElement('div');
                logItem.classList.add('log-item');
                logItem.textContent = message;
                logBox.appendChild(logItem);
                logBox.scrollTop = logBox.scrollHeight;
            } else {
                console.log(message); 
            }
        }


        async function listAllTokens() {
            logMessage("Fetching all tokens to update the main list...");
            try {
                const response = await fetch('/api/listAllTokens', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify([]) 
                });

                if (response.ok) {
                    let fetchedTokens = await response.json(); 
                    logMessage("Total tokens fetched: " + fetchedTokens.length);

                    mainTokensList = fetchedTokens.filter(token => token.listed === true);
                    logMessage("Main tokens list updated: " + mainTokensList.length + " tokens are listed");

                    if (mainTokensList.length > 0) {
                        logMessage("First listed token: " + JSON.stringify(mainTokensList[0]));
                    }

                    fetchAndFilterTokens(); 
                } else {
                    const errorText = await response.text();
                    logMessage("Failed to fetch tokens: " + errorText);
                }
            } catch (error) {
                logMessage('Error fetching tokens: ' + error.message);
            }
        }

        async function removeOrder(orderID) {
            if (confirm("Are you sure you want to remove this order?")) {
                try {
                    const response = await fetch('/api/removeOrder', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify([orderID])
                    });

                    if (response.ok) {
                        alert("Order removed successfully!");
                    } else {
                        const errorText = await response.text();
                        alert("Failed to remove order: " + errorText);
                    }
                } catch (error) {
                }
            }
        }

        function getSelectedCheckboxes(prefix) {
            const checkboxes = document.querySelectorAll("input[id^=\"" + prefix + "\"]:checked");
            return Array.from(checkboxes).map(checkbox => checkbox.labels[0].innerText.trim());
        }

        function getSelectedDropdownOptions(dropdownId) {
            const selectedOptions = document.getElementById(dropdownId).selectedOptions;
            return Array.from(selectedOptions).map(option => option.text.trim());
        }

        function truncateString(str, num = 15) {
            if (str.length <= num) {
                return str;
            }
            return str.slice(0, num) + '...';
        }

        function calculateUserPriceForToken(token) {
            try {
                logMessage("Calculating user price for token " + token.tradingPlatformID + "...");

                const maxPriceInput = document.getElementById('max-price');
                if (!maxPriceInput) {
                    logMessage('Error: maxPriceInput is not found.');
                    return null;  
                }

                const maxPrice = parseFloat(maxPriceInput.value);
                if (isNaN(maxPrice)) {
                    logMessage('Error: maxPrice is not a valid number.');
                    return null;  
                }

                logMessage("Baseline Price: " + maxPrice);

                const coefficients = {
                    Registry: {},
                    Sector: {},
                    Location: {}
                };

                sliders.forEach(slider => {
                    if (slider.parentElement && slider.parentElement.style.display !== 'none') {
                        const group = slider.parentElement.getAttribute('data-group');
                        const name = slider.parentElement.querySelector('label').textContent.trim();
                        coefficients[group][name] = parseFloat(slider.value);
                        logMessage("Found slider for " + group + ": " + name + ", value: " + coefficients[group][name]);
                    }
                });

                const projectData = token.unitData?.issuanceData?.projectData || {};
                logMessage("Project Data: " + JSON.stringify(projectData));

                const registry = projectData.currentRegistry || '';
                const sector = projectData.sector || '';
                const location = projectData.locations?.map(loc => loc.country.toLowerCase()) || [];

                logMessage("Token's Registry: " + registry);
                logMessage("Token's Sector: " + sector);
                logMessage("Token's Location: " + location.join(', '));

                let userPrice = maxPrice;

                if (coefficients.Registry[registry] !== undefined) {
                    userPrice += coefficients.Registry[registry];
                    logMessage("Applied Registry Adjustment: " + coefficients.Registry[registry] + ", New Price: " + userPrice);
                } else {
                    logMessage('No Registry Adjustment Applied');
                }

                if (coefficients.Sector[sector] !== undefined) {
                    userPrice += coefficients.Sector[sector];
                    logMessage("Applied Sector Adjustment: " + coefficients.Sector[sector] + ", New Price: " + userPrice);
                } else {
                    logMessage('No Sector Adjustment Applied');
                }

                const matchedRegion = Object.keys(regionCountries).find(region =>
                    location.some(loc => regionCountries[region]
                        .map(country => country.toLowerCase().trim())
                        .includes(loc.toLowerCase().trim()))
                );

                if (matchedRegion && coefficients.Location[matchedRegion] !== undefined) {
                    userPrice += coefficients.Location[matchedRegion];
                    logMessage("Applied Location Adjustment: " + coefficients.Location[matchedRegion] + ", New Price: " + userPrice);
                } else {
                    logMessage('No Location Adjustment Applied');
                }

                logMessage("Final User Price for Token: " + userPrice);
                return userPrice.toFixed(2);
            } catch (error) {
                logMessage("Error in calculateUserPriceForToken: " + error.message);
                return null;  
            }
        }

        function calculateBreakdownForToken(token) {
            logMessage("Calculating breakdown for token " + token.tradingPlatformID + "...");
            const coefficients = {
                Registry: {},
                Sector: {},
                Location: {}
            };

            sliders.forEach(slider => {
                if (slider.parentElement.style.display !== 'none') {
                    const group = slider.parentElement.getAttribute('data-group');
                    const name = slider.parentElement.querySelector('label').textContent.trim();
                    coefficients[group][name] = parseFloat(slider.value);
                }
            });

            const projectData = token.unitData?.issuanceData?.projectData;
            const registry = projectData?.currentRegistry?.toLowerCase().replace(/ /g, '-') || '';
            const sector = projectData?.sector?.toLowerCase().replace(/ /g, '-') || '';
            const location = projectData?.locations?.map(loc => loc.country.toLowerCase()) || [];

            let breakdown = [];

            if (coefficients.Registry[registry]) {
                breakdown.push("Registry: " + coefficients.Registry[registry].toFixed(2));
            }
            if (coefficients.Sector[sector]) {
                breakdown.push("Sector: " + coefficients.Sector[sector].toFixed(2));
            }

            const locationMatch = Object.keys(regionCountries).find(region => {
                return location.some(loc => regionCountries[region].includes(loc));
            });

            if (locationMatch && coefficients.Location[locationMatch]) {
                breakdown.push("Location: " + coefficients.Location[locationMatch].toFixed(2));
            }

            return breakdown.length ? breakdown.join(' + ') : 'No adjustments';
        }

        function createTokenRow(token, isMatch, isImmediateFill = false, fillQuantity = 0) {
            logMessage("Creating token row for " + token.tradingPlatformID + "...");

            const tokenRow = document.createElement('tr');
            tokenRow.classList.add('token-item');
            const pricePerToken = parseFloat(token.listedUnitPrice);

            if (isMatch) {
                const userPrice = calculateUserPriceForToken(token);
                const priceDifference = userPrice - pricePerToken;

                const fillUnitCountColumn = isImmediateFill ? `<td>${fillQuantity}</td>` : '';

                tokenRow.innerHTML =
                    `
                    <td>${truncateString(token.warehouseUnitID)}</td>
                    <td>${truncateString(token.tradingPlatformID)}</td>
                    <td>${truncateString(token.owner)}</td>
                    <td>${token.unitCount}</td>
                    <td>${pricePerToken.toFixed(2)}</td>
                    <td>${truncateString(token.unitData?.issuanceData?.projectData?.currentRegistry || 'N/A')}</td>
                    <td>${truncateString(token.unitData?.issuanceData?.projectData?.sector || 'N/A')}</td>
                    <td>${truncateString(token.unitData?.issuanceData?.projectData?.locations?.map(loc => loc.country).join(', ') || 'N/A')}</td>
                    <td>${token.unitData?.vintageYear || 'N/A'}</td>
                    <td>${userPrice}</td>
                    <td class="${priceDifference >= 0 ? 'price-difference-positive' : 'price-difference-negative'}">${priceDifference.toFixed(2)}</td>
                    ${fillUnitCountColumn}
                    `;
            } else {
                const reasons = token.filteredOutReasons;
                tokenRow.innerHTML = `
                    <td>${truncateString(token.warehouseUnitID)}</td>
                    <td>${truncateString(token.tradingPlatformID)}</td>
                    <td>${truncateString(token.owner)}</td>
                    <td>${token.unitCount}</td>
                    <td>${pricePerToken.toFixed(2)}</td>
                    <td class="${reasons.paymentToken ? '' : 'background-red'}">${truncateString(token.tokenName)}</td>
                    <td class="${reasons.registry ? '' : 'background-red'}">${truncateString(token.unitData?.issuanceData?.projectData?.currentRegistry || 'N/A')}</td>
                    <td class="${reasons.sector ? '' : 'background-red'}">${truncateString(token.unitData?.issuanceData?.projectData?.sector || 'N/A')}</td>
                    <td class="${reasons.location ? '' : 'background-red'}">${truncateString(token.unitData?.issuanceData?.projectData?.locations?.map(loc => loc.country).join(', ') || 'N/A')}</td>
                    <td class="${reasons.vintageYear ? '' : 'background-red'}">${token.unitData?.vintageYear || 'N/A'}</td>
                    `;
            }

            return tokenRow;
        }


        function filterTokens(tokens) {
            logMessage("Filtering tokens...");
            logMessage("Tokens before filtering:\n" + JSON.stringify(tokens, null, 2));

            const isInformationAgnostic = document.getElementById('order-type-information-agnostic').checked;

            const passedTokensTableBody = document.getElementById('passed-tokens-table-body');
            const filteredTokensTableBody = document.getElementById('filtered-tokens-table-body');
            const immediateOrderFillTableBody = document.getElementById('immediate-order-fill-table-body');
            const immediateOrderFillSummaryDiv = document.getElementById('immediate-order-fill-summary');

            passedTokensTableBody.innerHTML = '';  
            filteredTokensTableBody.innerHTML = '';  
            immediateOrderFillTableBody.innerHTML = ''; 
            immediateOrderFillSummaryDiv.innerHTML = ''; 

            let totalQuantityNeeded = parseInt(document.getElementById('quantity').value) || 0;
            let remainingQuantity = totalQuantityNeeded;
            let totalImmediateFillCount = 0; 

            const fillMethod = document.querySelector('input[name="fill-method"]:checked').value;

            if (fillMethod === 'cheapest') {
                tokens.sort((a, b) => parseFloat(a.listedUnitPrice) - parseFloat(b.listedUnitPrice));
            } else if (fillMethod === 'max-value') {
                tokens.sort((a, b) => {
                    const priceDifferenceA = calculateUserPriceForToken(a) - parseFloat(a.listedUnitPrice);
                    const priceDifferenceB = calculateUserPriceForToken(b) - parseFloat(b.listedUnitPrice);
                    return priceDifferenceB - priceDifferenceA;
                });
            }

            tokens.forEach(token => {
                const pricePerToken = parseFloat(token.listedUnitPrice);

                const projectData = token.unitData?.issuanceData?.projectData || {};
                const vintageYear = token.unitData?.vintageYear || 'N/A';

                const enteredPaymentToken = document.getElementById('payment-token').value.trim();
                const vintageYearRangeStart = parseInt(document.getElementById('vintage-year-range-start').value, 10);
                const vintageYearRangeEnd = parseInt(document.getElementById('vintage-year-range-end').value, 10);

                const isPaymentTokenMatching = token.tokenName.trim().toLowerCase() === enteredPaymentToken.toLowerCase();
                const isVintageYearInRange = vintageYear !== 'N/A' && vintageYear >= vintageYearRangeStart && vintageYear <= vintageYearRangeEnd;

                let isFilteredOut = false;

                if (isInformationAgnostic) {
                    if (!isPaymentTokenMatching || !isVintageYearInRange) {
                        isFilteredOut = true;
                    }
                } else {
                    const currentRegistry = projectData.currentRegistry || 'N/A';
                    const currentSector = projectData.sector || 'N/A';
                    const currentLocation = projectData.locations?.map(loc => loc.country) || ['N/A'];

                    const selectedRegistries = getSelectedCheckboxes('registry');
                    const selectedSectors = getSelectedDropdownOptions('sector-dropdown');
                    const selectedLocations = getSelectedCheckboxes('country');

                    const matchesRegistry = selectedRegistries.includes(currentRegistry);
                    const matchesSector = selectedSectors.includes(currentSector);
                    const matchesLocation = selectedLocations.some(selectedLocation => {
                        return currentLocation.some(tokenLocation => {
                            return regionCountries[selectedLocation]?.includes(tokenLocation);
                        });
                    });

                    isFilteredOut = !isPaymentTokenMatching || !isVintageYearInRange || !matchesRegistry || !matchesSector || !matchesLocation;
                }

                if (!isFilteredOut) {
                    const tokenRow = createTokenRow(token, true);
                    passedTokensTableBody.appendChild(tokenRow);

                    const userPrice = calculateUserPriceForToken(token);
                    const priceDifference = userPrice - pricePerToken;

                    if (priceDifference >= 0 && remainingQuantity > 0) {
                        const fillQuantity = Math.min(remainingQuantity, token.unitCount);
                        const immediateFillRow = createTokenRow(token, true, true, fillQuantity);
                        immediateOrderFillTableBody.appendChild(immediateFillRow);
                        remainingQuantity -= fillQuantity;
                        totalImmediateFillCount += fillQuantity;  
                    }
                } else {
                    const filteredOutReasons = {
                        paymentToken: isPaymentTokenMatching,
                        vintageYear: isVintageYearInRange
                    };
                    token.filteredOutReasons = filteredOutReasons; 
                    const tokenRow = createTokenRow(token, false);
                    filteredTokensTableBody.appendChild(tokenRow);
                }
            });

            immediateOrderFillSummaryDiv.innerHTML = `<h2>Immediate Order Fill Summary</h2><p>Total Immediate Order Fill Unit Count: ${totalImmediateFillCount}</p>`;

            const totalListedUnits = tokens.reduce((sum, token) => sum + (token.unitCount || 0), 0);
            document.getElementById('total-listed-units').textContent = totalListedUnits.toLocaleString();
        }





        function fetchAndFilterTokens() {
            logMessage("Filtering tokens...");
            if (!mainTokensList.length) {
                logMessage("No tokens available to filter.");
                return;
            }

            const filteredTokensList = mainTokensList.filter(token => {
                return true;
            });

            logMessage("Filtered tokens count: " + filteredTokensList.length);

            filterTokens(filteredTokensList);
            updateCounts(filteredTokensList); 

            matches.length = 0;
        }

        function updateCounts(tokens) {
            logMessage("Updating counts...");

            const selectedRegistries = getSelectedCheckboxes('registry');
            const selectedSectors = getSelectedDropdownOptions('sector-dropdown');
            const selectedLocations = getSelectedCheckboxes('country');
            const enteredPaymentToken = document.getElementById('payment-token').value.trim().toLowerCase();
            const vintageYearRangeStart = parseInt(document.getElementById('vintage-year-range-start').value, 10);
            const vintageYearRangeEnd = parseInt(document.getElementById('vintage-year-range-end').value, 10);

            const registryCounts = {};
            const sectorCounts = {};
            const locationCounts = {};

            $('.checkbox-container input').each(function () {
                const label = $(this).next('label').text().trim();
                if ($(this).attr('id').startsWith('registry')) {
                    registryCounts[label] = 0;
                } else if ($(this).attr('id').startsWith('country')) {
                    locationCounts[label] = 0;
                }
            });

            $('#sector-dropdown option').each(function () {
                const label = $(this).data('original-text') || $(this).text().trim();
                $(this).text(label);
            });

            let totalListedUnits = 0; 

            tokens.forEach(token => {
                const projectData = token.unitData?.issuanceData?.projectData || {};
                const registry = projectData.currentRegistry || 'N/A';
                const sector = projectData.sector || 'N/A';
                const locations = projectData.locations?.map(loc => loc.country) || ['N/A'];
                const state = token.burned ? 'Burned' : token.listed ? 'Listed' : 'N/A';
                const vintageYear = token.unitData?.vintageYear || 'N/A';
                const tokenPayment = token.tokenName.trim().toLowerCase();

                const isListed = state === 'Listed';
                const isPaymentTokenMatching = enteredPaymentToken === tokenPayment;
                const isVintageYearInRange = vintageYear !== 'N/A' && vintageYear >= vintageYearRangeStart && vintageYear <= vintageYearRangeEnd;

                if (isListed) {
                    totalListedUnits += token.unitCount; 

                    const matchedRegions = locations.map(location =>
                        Object.keys(regionCountries).find(region => regionCountries[region].includes(location))
                    ).filter(region => region !== undefined);

                    logMessage(`Token: ${token.tradingPlatformID}, Locations: ${locations.join(', ')}, Matched Regions: ${matchedRegions.join(', ')}`);

                    if (sectorMatchesSelected(sector, selectedSectors) && locationMatchesSelected(matchedRegions, selectedLocations)) {
                        if (registryCounts[registry] !== undefined) {
                            registryCounts[registry] += token.unitCount;
                            logMessage(`Registry match: ${registry}, Count updated to: ${registryCounts[registry]}`);
                        }
                    } else {
                        logMessage(`Sector match failed for token: ${token.tradingPlatformID}, Sector: ${sector}, Selected Sectors: ${selectedSectors.join(', ')}`);
                    }

                    if (registryMatchesSelected(registry, selectedRegistries) && locationMatchesSelected(matchedRegions, selectedLocations)) {
                        if (sectorCounts[sector] !== undefined) {
                            sectorCounts[sector] += token.unitCount;
                            logMessage(`Sector match: ${sector}, Count updated to: ${sectorCounts[sector]}`);
                        }
                    } else {
                        logMessage(`Sector count update failed for token: ${token.tradingPlatformID}, Sector: ${sector}, Selected Sectors: ${selectedSectors.join(', ')}`);
                    }

                    matchedRegions.forEach(region => {
                        if (registryMatchesSelected(registry, selectedRegistries) && sectorMatchesSelected(sector, selectedSectors)) {
                            if (locationCounts[region] !== undefined) {
                                locationCounts[region] += token.unitCount;
                                logMessage(`Location match: ${region}, Count updated to: ${locationCounts[region]}`);
                            }
                        } else {
                            logMessage(`Location count update failed for token: ${token.tradingPlatformID}, Region: ${region}, Selected Locations: ${selectedLocations.join(', ')}`);
                        }
                    });
                }
            });

            $('.checkbox-container input').each(function () {
                const label = $(this).next('label').text().trim();
                const countSpan = $(this).nextAll('.count-span');
                const count = $(this).attr('id').startsWith('registry') ? registryCounts[label] : locationCounts[label];
                countSpan.html(count > 0 ? (`<span class="count-green">${count}</span>`) : '');
            });

            $('#sector-dropdown option').each(function () {
                const label = $(this).data('original-text') || $(this).text().trim();
                $(this).text(label);
            });

            document.getElementById('total-listed-units').textContent = totalListedUnits.toLocaleString();

            function locationMatchesSelected(locations, selectedLocations) {
                if (selectedLocations.length === 0) return true;
                const match = selectedLocations.some(location => locations.includes(location));
                logMessage(`Checking locations: ${locations.join(', ')} against selected: ${selectedLocations.join(', ')}. Match: ${match}`);
                return match;
            }

            function sectorMatchesSelected(sector, selectedSectors) {
                if (selectedSectors.length === 0) return true;
                logMessage(`Checking sector: ${sector} against selected sectors: ${selectedSectors.join(', ')}`);
                const match = selectedSectors.includes(sector);
                logMessage(`Sector match result: ${match}`);
                return match;
            }

            function registryMatchesSelected(registry, selectedRegistries) {
                if (selectedRegistries.length === 0) return true;
                const match = selectedRegistries.includes(registry);
                logMessage(`Checking registry: ${registry} against selected: ${selectedRegistries.join(', ')}. Match: ${match}`);
                return match;
            }
        }
        let sliders;

        document.addEventListener('DOMContentLoaded', () => {
            const sliders = document.querySelectorAll('.slider');
            const checkboxes = document.querySelectorAll('.checkbox-container input');
            const paymentTokenInput = document.getElementById('payment-token');
            const maxPriceInput = document.getElementById('max-price');
            const quantityInput = document.getElementById('quantity');
            const vintageYearRangeStartInput = document.getElementById('vintage-year-range-start');
            const vintageYearRangeEndInput = document.getElementById('vintage-year-range-end');
            const regressionEquationDiv = document.getElementById('regression-equation');
            const quantityDisplayDiv = document.getElementById('quantity-display');
            const vintageYearRangeDisplayDiv = document.getElementById('vintage-year-range-display');
            const paymentTokenDisplayDiv = document.getElementById('payment-token-display');
            const totalPriceEscrowDisplayDiv = document.getElementById('total-price-escrow-display');
            const sectorDropdown = document.getElementById('sector-dropdown');
            const paymentTokenError = document.getElementById('payment-token-error');
            const maxPriceError = document.getElementById('max-price-error');
            const quantityError = document.getElementById('quantity-error');
            const vintageYearRangeError = document.getElementById('vintage-year-range-error');
            const variationError = document.getElementById('variation-error');
            const submitButton = document.getElementById('submit-button');
            const listTokensButton = document.getElementById('list-tokens-button');
            const listAllTokensButton = document.getElementById('list-all-tokens-button');
            const infoAgnosticRadio = document.getElementById('order-type-information-agnostic');
            const infoDependentRadio = document.getElementById('order-type-information-dependent');

            paymentTokenInput.addEventListener('input', validateInputs);
            maxPriceInput.addEventListener('input', () => {
                validateInputs();
                updateSliders();
            });
            quantityInput.addEventListener('input', validateInputs);
            vintageYearRangeStartInput.addEventListener('input', validateInputs);
            vintageYearRangeEndInput.addEventListener('input', validateInputs);

            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    toggleSliderContainers();
                    validateInputs();
                });
            });

            sliders.forEach(slider => {
                slider.addEventListener('input', () => {
                    updateSliderValue(slider);
                    validateInputs();
                });
            });

            sectorDropdown.addEventListener('change', () => {
                updateSectorSliders();
                validateInputs();
            });

            infoAgnosticRadio.addEventListener('change', validateInputs);
            infoDependentRadio.addEventListener('change', validateInputs);

            submitButton.addEventListener('click', () => {
                if (validateInputs()) {
                    submitOrder();
                }
            });

            listTokensButton.addEventListener('click', fetchAndFilterTokens);
            listAllTokensButton.addEventListener('click', listAllTokens);

            document.querySelectorAll('input, select').forEach(input => {
                input.addEventListener('change', fetchAndFilterTokens);
            });

            function validateInputs() {
                logMessage("Validating inputs...");
                const paymentToken = paymentTokenInput.value.trim();
                const maxPrice = parseFloat(maxPriceInput.value) || 0;
                const quantity = parseInt(quantityInput.value) || 1;
                const vintageYearRangeStart = parseInt(vintageYearRangeStartInput.value) || 0;
                const vintageYearRangeEnd = parseInt(vintageYearRangeEndInput.value) || 0;

                const isPaymentTokenValid = paymentToken.length > 0;
                const isMaxPriceValid = !isNaN(maxPrice) && maxPrice >= 0;
                const isQuantityValid = !isNaN(quantity) && quantity > 0;
                const isVintageYearRangeValid = !isNaN(vintageYearRangeStart) && !isNaN(vintageYearRangeEnd) && vintageYearRangeStart <= vintageYearRangeEnd;

                paymentTokenError.textContent = isPaymentTokenValid ? '' : 'Please enter a payment token';
                maxPriceError.textContent = isMaxPriceValid ? '' : 'Please enter a valid positive number';
                quantityError.textContent = isQuantityValid ? '' : 'Please enter a valid positive number';
                vintageYearRangeError.textContent = isVintageYearRangeValid ? '' : 'Start year should be less than or equal to end year';

                logMessage("Payment token valid: " + isPaymentTokenValid);
                logMessage("Max price valid: " + isMaxPriceValid);
                logMessage("Quantity valid: " + isQuantityValid);
                logMessage("Vintage year range valid: " + isVintageYearRangeValid);

                const infoDependent = infoDependentRadio.checked;
                let isValid = isPaymentTokenValid && isMaxPriceValid && isQuantityValid && isVintageYearRangeValid;
                variationError.textContent = '';

                if (infoDependent) {
                    const hasRegistry = checkboxesHasSelection('registry');
                    const hasSector = sectorDropdown.selectedOptions.length > 0;
                    const hasCountry = checkboxesHasSelection('country');

                    if (!hasRegistry) {
                        variationError.textContent += 'No Registry selected. ';
                        isValid = false;
                    }
                    if (!hasSector) {
                        variationError.textContent += 'No Sector selected. ';
                        isValid = false;
                    }
                    if (!hasCountry) {
                        variationError.textContent += 'No Country selected. ';
                        isValid = false;
                    }

                    logMessage("Information dependent order validation: Registry selected: " + hasRegistry + ", Sector selected: " + hasSector + ", Country selected: " + hasCountry);
                }

                if (isValid) {
                    updateOutputs();
                }

                return isValid;
            }

            function checkboxesHasSelection(type) {
                return Array.from(checkboxes).some(checkbox => checkbox.id.startsWith(type) && checkbox.checked);
            }

            function updateSectorSliders() {
                logMessage("Updating sector sliders...");
                const selectedSectors = Array.from(sectorDropdown.selectedOptions)
                    .map(option => option.text.replace(/[^a-zA-Z]/g, '').toLowerCase());

                document.querySelectorAll('.slider-container').forEach(container => {
                    const containerName = container.id.replace('slider', '').replace(/[^a-zA-Z]/g, '').toLowerCase();
                    container.style.display = selectedSectors.includes(containerName) ? 'flex' : 'none';
                });

                validateInputs();
            }

            function toggleSliderContainers() {
                logMessage("Toggling slider containers...");
                checkboxes.forEach(checkbox => {
                    const sliderName = checkbox.labels[0].innerText.trim().replace(/ /g, '-');
                    const sliderContainer = document.getElementById('slider-' + sliderName);
                    sliderContainer.style.display = checkbox.checked ? 'flex' : 'none';
                });
                validateInputs();
            }

            function updateSliderValue(slider) {
                logMessage("Updating slider value: " + slider.id);
                const valueSpan = document.getElementById("value-" + slider.id);
                valueSpan.textContent = slider.value;
            }

            function updateSliders() {
                logMessage("Updating sliders...");
                const maxPrice = parseFloat(maxPriceInput.value) || 0;
                sliders.forEach(slider => {
                    slider.min = -maxPrice;
                    updateSliderValue(slider);
                });
                validateInputs();
            }

            function updateOutputs() {
                logMessage("Updating outputs...");
                const coefficients = {
                    Registry: {},
                    Sector: {},
                    Location: {}
                };
                sliders.forEach(slider => {
                    if (slider.parentElement.style.display !== 'none') {
                        const group = slider.parentElement.getAttribute('data-group');
                        const name = slider.parentElement.querySelector('label').textContent.trim();
                        coefficients[group][name] = parseFloat(slider.value);
                    }
                });

                const maxPrice = parseFloat(maxPriceInput.value) || 0;
                const quantity = parseInt(quantityInput.value) || 1;
                const vintageYearRangeStart = vintageYearRangeStartInput.value;
                const vintageYearRangeEnd = vintageYearRangeEndInput.value;
                const paymentToken = paymentTokenInput.value.trim();

                const regressionEquation = generateRegressionEquation(maxPrice, coefficients);
                const totalPriceEscrow = maxPrice * quantity;

                const regressionEquationElement = document.getElementById('regression-equation');
                regressionEquationElement.textContent = regressionEquation;

                const fontSize = getFontSize(regressionEquation);
                regressionEquationElement.style.fontSize = fontSize;

                document.getElementById('quantity-display').textContent = quantity;
                document.getElementById('vintage-year-range-display').textContent = `${vintageYearRangeStart} - ${vintageYearRangeEnd}`;
                document.getElementById('payment-token-display').textContent = paymentToken;
                document.getElementById('total-price-escrow-display').textContent = totalPriceEscrow.toFixed(2);

                logMessage("Outputs updated:");
                logMessage("Regression equation: " + regressionEquation);
                logMessage("Quantity: " + quantity);
                logMessage("Vintage year range: " + vintageYearRangeStart + " - " + vintageYearRangeEnd);
                logMessage("Payment token: " + paymentToken);
                logMessage("Total Price (Escrow): " + totalPriceEscrow);
            }

            function truncateName(name) {
                return name.length > 15 ? name.substring(0, 12) + '...' : name;
            }

            function generateRegressionEquation(maxPrice, coefficients) {
                let equation = "Price = " + maxPrice;

                for (const [group, items] of Object.entries(coefficients)) {
                    if (Object.keys(items).length > 0) {
                        equation += ` + ${group}: ( ${Object.entries(items).map(([name, value]) => `${name}: ${value.toFixed(2)}`).join(' + ')} )`;
                    }
                }

                return equation;
            }

            function getFontSize(equation) {
                const length = equation.length;
                return Math.max(1, 2 - (length / 200)) + "rem";
            }

            async function submitOrder() {
                logMessage("Submitting order...");
                const paymentToken = paymentTokenInput.value.trim();
                const maxPrice = parseFloat(maxPriceInput.value) || 0;
                const quantity = parseInt(quantityInput.value) || 1;
                const vintageYearRangeStart = vintageYearRangeStartInput.value;
                const vintageYearRangeEnd = vintageYearRangeEndInput.value;
                const vintageYearRange = vintageYearRangeStart + " - " + vintageYearRangeEnd;
                const orderType = infoDependentRadio.checked ? 'Information Dependent' : 'Information Agnostic';

                const coefficients = {
                    Registry: {},
                    Sector: {},
                    Location: {}
                };
                sliders.forEach(slider => {
                    if (slider.parentElement.style.display !== 'none') {
                        const group = slider.parentElement.getAttribute('data-group');
                        const name = slider.parentElement.querySelector('label').textContent.trim();
                        coefficients[group][name] = parseFloat(slider.value);
                    }
                });

                const matches = [];
                const immediateFillTokens = document.querySelectorAll('#immediate-order-fill-table-body .token-item');

                immediateFillTokens.forEach(tokenItem => {
                    const tradingPlatformID = tokenItem.querySelector('td:nth-child(2)').textContent.trim();
                    const userPrice = parseFloat(tokenItem.querySelector('td:nth-child(10)').textContent.trim());
                    const pricePerToken = parseFloat(tokenItem.querySelector('td:nth-child(5)').textContent.trim());

                    const priceDifference = userPrice - pricePerToken;

                    if (priceDifference >= 0) {
                        matches.push({
                            "TradingPlatformID": tradingPlatformID,
                            "DesiredPrice": userPrice
                        });
                        logMessage(`Token ${tradingPlatformID} added to matches with user price ${userPrice} and price difference ${priceDifference}.`);
                    } else {
                        logMessage(`Token ${tradingPlatformID} not added to matches. User price ${userPrice} is less than price per token ${pricePerToken} with a price difference of ${priceDifference}.`);
                    }
                });

                const orderArgs = [
                    paymentToken,
                    maxPrice.toString(),
                    quantity.toString(),
                    vintageYearRange,
                    orderType,
                    JSON.stringify(coefficients),
                    JSON.stringify(matches)
                ];

                logMessage('Order Submitted: ' + JSON.stringify(orderArgs));

                try {
                    const response = await fetch('/api/createOrder', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(orderArgs)
                    });

                    if (response.ok) {
                        alert('Order submitted successfully!');
                    } else {
                        const errorText = await response.text();
                        alert("Failed to submit order: " + errorText);
                    }
                } catch (error) {
                    console.error('Error submitting order:', error);
                    alert('Failed to submit order due to an unexpected error.');
                }
            }


            const fillByCheapestRadio = document.getElementById('fill-by-cheapest');
            const fillByMaxValueRadio = document.getElementById('fill-by-max-value');

            fillByCheapestRadio.addEventListener('change', fetchAndFilterTokens);
            fillByMaxValueRadio.addEventListener('change', fetchAndFilterTokens);

            const clientIDBox = document.getElementById('clientIDBox');

            fetch('/api/getClientIdentity', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify([])
            })
            .then(response => response.text())
            .then(id => {
                fullClientID = id;
                clientIDBox.innerHTML = `Client ID: ${id.length > 10 ? id.substring(0, 10) + '...' : id} <img src="assets/Copy.png" class="icon" data-text="${id}">`;
                document.querySelector('.icon').addEventListener('click', event => {
                    copyToClipboard(event.target.dataset.text);
                });
            })
            .catch(error => {
                clientIDBox.textContent = 'Client ID: Failed';
                logMessage(`Error retrieving Client ID`);
            });
        });


        document.addEventListener('DOMContentLoaded', () => {
            const listAllOrdersButton = document.getElementById('list-all-orders-button');
            listAllOrdersButton.addEventListener('click', listAllOrders);


            async function listAllOrders() {
                logMessage("Fetching all orders...");
                try {
                    const response = await fetch('/api/listAllOrders', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify([]) 
                    });

                    if (!response.ok) {
                        throw new Error(`Error retrieving orders: ${response.statusText}`);
                    }

                    const orders = await response.json();
                    logMessage(`Total orders fetched: ${orders.length}`);

                    const orderHistoryTableBody = document.getElementById('order-history-table-body');
                    orderHistoryTableBody.innerHTML = ''; 

                    const clientIDBox = document.getElementById('clientIDBox');

                    orders.forEach(order => {
                        if (order.owner === fullClientID) { 
                            const orderRow = createOrderRow(order);
                            orderHistoryTableBody.appendChild(orderRow);
                        } else {
                            logMessage(`Order did not match. order.owner: ${order.owner} clientID: ${fullClientID}`);
                        }
                    });

                } catch (error) {
                    logMessage(`Error retrieving orders: ${error.message}`);
                }
            }



            function createOrderRow(order) {
                const orderRow = document.createElement('tr');

                const pricingEquation = createPricingEquation(order);
                const shortPricingEquation = createShortPricingEquation(order);

                const pricingEquationTooltip = `
                    <div class="tooltip">
                        ${shortPricingEquation}
                        <span class="tooltiptext">Pricing Equation: ${pricingEquation}</span>
                    </div>
                `;

                const filledWithTokens = order.filledWith.join(', ');

                const filledOrderClass = order.filled ? 'background-red' : '';

                const removeOrderButton = order.filled ? '' : `
                    <td class="${filledOrderClass}">
                        <button class="submit-button" onclick="removeOrder('${order.orderID}')">Remove Order</button>
                    </td>
                `;

                orderRow.innerHTML = `
                    <td class="${filledOrderClass}">${truncateString(order.orderID)}</td>
                    <td class="${filledOrderClass}">${pricingEquationTooltip}</td>
                    <td class="${filledOrderClass}">${order.quantity}</td>
                    <td class="${filledOrderClass}">${order.vintageYearRange}</td>
                    <td class="${filledOrderClass}">${order.paymentToken}</td>
                    <td class="${filledOrderClass}">${order.escrowedAmount}</td>
                    <td class="${filledOrderClass}">${truncateString(filledWithTokens, 30)}</td>
                    ${removeOrderButton}
                `;

                return orderRow;
            }


            function createPricingEquation(order) {
                let pricingEquation = `Price = ${order.maxPrice.toFixed(2)}`;

                if (order.orderType === 'Information Dependent') {
                    const registryCoefficients = Object.entries(order.coefficients.Registry)
                        .map(([registry, value]) => `${registry}: ${value.toFixed(2)}`)
                        .join(', ');
                    pricingEquation += `\nRegistry: ${registryCoefficients}`;

                    const sectorCoefficients = Object.entries(order.coefficients.Sector)
                        .map(([sector, value]) => `${sector}: ${value.toFixed(2)}`)
                        .join(', ');
                    pricingEquation += `\nSector: ${sectorCoefficients}`;

                    const locationCoefficients = Object.entries(order.coefficients.Location)
                        .map(([location, value]) => `${location}: ${value.toFixed(2)}`)
                        .join(', ');
                    pricingEquation += `\nLocation: ${locationCoefficients}`;
                }

                return pricingEquation;
            }

            function truncateStringWithEllipsis(str, maxLength) {
                if (str.length > maxLength) {
                    return str.substring(0, maxLength) + '...';
                }
                return str;
            }


            function createShortPricingEquation(order) {
                let pricingEquation = `Price = ${order.maxPrice.toFixed(2)}`;

                if (order.orderType === 'Information Dependent') {
                    const firstRegistry = Object.entries(order.coefficients.Registry)[0];
                    if (firstRegistry) {
                        pricingEquation += ` + Registry: ${truncateStringWithEllipsis(firstRegistry[0], 20)}: ${firstRegistry[1].toFixed(2)}`;
                    }

                    const firstSector = Object.entries(order.coefficients.Sector)[0];
                    if (firstSector) {
                        pricingEquation += ` + Sector: ${truncateStringWithEllipsis(firstSector[0], 20)}: ${firstSector[1].toFixed(2)}`;
                    }

                    const firstLocation = Object.entries(order.coefficients.Location)[0];
                    if (firstLocation) {
                        pricingEquation += ` + Location: ${truncateStringWithEllipsis(firstLocation[0], 20)}: ${firstLocation[1].toFixed(2)}`;
                    }
                }

                return pricingEquation;
            }


            function truncateString(str, num = 15) {
                if (str.length <= num) {
                    return str;
                }
                return str.slice(0, num) + '...';
            }
        });



        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            alert('Copied to clipboard: ' + text);
        }
    </script>
</head>

<body>
    <div class="nav-bar">
        <a href="index.html">Database</a>
        <a href="OrderBookOrder.html">Order Book - Order</a>
        <a href="OrderBookList.html">Order Book - List</a>
    </div>

    <div class="header">
        <h1>Carbon Market Bridge - Order Book - Order</h1>
        <div id="clientIDBox" class="client-id-box">Client ID: Fetching...</div>
    </div>

    <div class="content">
        <div>
            <h2>Inputs</h2>
            <div class="input-group">
                <label for="payment-token">Payment Token: </label>
                <input type="text" id="payment-token">
                <span class="error" id="payment-token-error"></span>
            </div>
            <div class="input-group">
                <label for="max-price">Maximum Baseline Price for Carbon Credit: </label>
                <input type="number" id="max-price" min="0" step="0.01">
                <span class="error" id="max-price-error"></span>
            </div>
            <div class="input-group">
                <label for="quantity">Quantity of Carbon Credits: </label>
                <input type="number" id="quantity" min="1" step="1">
                <span class="error" id="quantity-error"></span>
            </div>
            <div class="input-group">
                <label for="vintage-year-range-start">Unit Vintage Year Range: </label>
                <input type="text" id="vintage-year-range-start" placeholder="Start Year"> -
                <input type="text" id="vintage-year-range-end" placeholder="End Year">
                <span class="error" id="vintage-year-range-error"></span>
            </div>
            <div class="order-type-container">
                <label>Order Type: </label>
                <input type="radio" id="order-type-information-agnostic" name="order-type" value="Information Agnostic">
                <label for="order-type-information-agnostic">Information Agnostic</label>
                <input type="radio" id="order-type-information-dependent" name="order-type" value="Information Dependent" checked>
                <label for="order-type-information-dependent">Information Dependent</label>
            </div>
            <div class="coefficient-group">
                <h2>CADT - Project</h2>
                <h3>Registry</h3>
                <div class="checkbox-container">
                    <input type="checkbox" id="registry-bcs-checkbox">
                    <label for="registry-bcs-checkbox">BioCarbon Standard</label>
                    <span class="count-span"></span>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="registry-cdm-checkbox">
                    <label for="registry-cdm-checkbox">CDM Registry</label>
                    <span class="count-span"></span>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="registry-eco-checkbox">
                    <label for="registry-eco-checkbox">EcoRegistry</label>
                    <span class="count-span"></span>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="registry-gcc-checkbox">
                    <label for="registry-gcc-checkbox">Global Carbon Council</label>
                    <span class="count-span"></span>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="registry-rkb-checkbox">
                    <label for="registry-rkb-checkbox">Royal Kingdom of Bhutan</label>
                    <span class="count-span"></span>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="registry-tero-checkbox">
                    <label for="registry-tero-checkbox">Tero Carbon</label>
                    <span class="count-span"></span>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="registry-verra-checkbox">
                    <label for="registry-verra-checkbox">Verra</label>
                    <span class="count-span"></span>
                </div>

                <div class="slider-container" id="slider-BioCarbon-Standard" data-group="Registry">
                    <label for="registry-bcs">BioCarbon Standard</label>
                    <input type="range" id="registry-bcs" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-registry-bcs">0</span>
                </div>
                <div class="slider-container" id="slider-CDM-Registry" data-group="Registry">
                    <label for="registry-cdm">CDM Registry</label>
                    <input type="range" id="registry-cdm" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-registry-cdm">0</span>
                </div>
                <div class="slider-container" id="slider-EcoRegistry" data-group="Registry">
                    <label for="registry-eco">EcoRegistry</label>
                    <input type="range" id="registry-eco" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-registry-eco">0</span>
                </div>
                <div class="slider-container" id="slider-Global-Carbon-Council" data-group="Registry">
                    <label for="registry-gcc">Global Carbon Council</label>
                    <input type="range" id="registry-gcc" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-registry-gcc">0</span>
                </div>
                <div class="slider-container" id="slider-Royal-Kingdom-of-Bhutan" data-group="Registry">
                    <label for="registry-rkb">Royal Kingdom of Bhutan</label>
                    <input type="range" id="registry-rkb" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-registry-rkb">0</span>
                </div>
                <div class="slider-container" id="slider-Tero-Carbon" data-group="Registry">
                    <label for="registry-tero">Tero Carbon</label>
                    <input type="range" id="registry-tero" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-registry-tero">0</span>
                </div>
                <div class="slider-container" id="slider-Verra" data-group="Registry">
                    <label for="registry-verra">Verra</label>
                    <input type="range" id="registry-verra" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-registry-verra">0</span>
                </div>
            </div>
            <div class="coefficient-group">
                <h3>Sector</h3>
                <div class="dropdown-container">
                    <label for="sector-dropdown">Select Sector(s): </label>
                    <select id="sector-dropdown" class="select-toggle" multiple>
                        <option value="sector-accommodation">Accommodation and food service activities</option>
                        <option value="sector-extraterritorial">Activities of extraterritorial organizations and bodies</option>
                        <option value="sector-households">Activities of households as employers; undifferentiated goods- and services-producing activities of households for own use</option>
                        <option value="sector-administrative">Administrative and support service activities</option>
                        <option value="sector-agriculture">Agriculture; forestry and fishing</option>
                        <option value="sector-arts">Arts, entertainment and recreation</option>
                        <option value="sector-carbon-capture">Carbon capture and storage</option>
                        <option value="sector-chemical">Chemical Industries</option>
                        <option value="sector-construction">Construction</option>
                        <option value="sector-education">Education</option>
                        <option value="sector-electricity">Electricity; gas, steam and air conditioning supply</option>
                        <option value="sector-energy-demand">Energy Demand</option>
                        <option value="sector-energy-distribution">Energy Distribution</option>
                        <option value="sector-energy-industries">Energy Industries (renewable/non-renewable sources)</option>
                        <option value="sector-financial">Financial and insurance activities</option>
                        <option value="sector-fugitive-emissions">Fugitive emissions from fuel (solid, oil and gas)</option>
                        <option value="sector-fugitive-halocarbons">Fugitive emissions from the production and consumption of halocarbons and sulfur hexafluoride</option>
                        <option value="sector-health">Human health and social work activities</option>
                        <option value="sector-information">Information and communication</option>
                        <option value="sector-livestock">Livestock, enteric fermentation, and manure management</option>
                        <option value="sector-manufacturing">Manufacturing</option>
                        <option value="sector-metal-production">Metal Production (Metallurgy)</option>
                        <option value="sector-mining">Mining and quarrying</option>
                        <option value="sector-other-services">Other service activities</option>
                        <option value="sector-professional">Professional, scientific and technical activities</option>
                        <option value="sector-public">Public administration and defence; compulsory social security</option>
                        <option value="sector-real-estate">Real estate activities</option>
                        <option value="sector-solvents">Solvents use</option>
                        <option value="sector-transportation">Transportation and storage</option>
                        <option value="sector-waste">Waste handling and disposal</option>
                        <option value="sector-water-supply">Water supply; sewerage, waste management and remediation activities</option>
                        <option value="sector-wholesale">Wholesale and retail trade; repair of motor vehicles and motorcycles</option>
                        <option value="sector-not-classified">Not elsewhere classified</option>
                    </select>
                </div>

                <div class="slider-container" id="slider-Accommodation-and-food-service-activities" data-group="Sector">
                    <label for="sector-accommodation">Accommodation and food service activities</label>
                    <input type="range" id="sector-accommodation" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-accommodation">0</span>
                </div>
                <div class="slider-container" id="slider-Activities-of-extraterritorial-organizations-and-bodies" data-group="Sector">
                    <label for="sector-extraterritorial">Activities of extraterritorial organizations and bodies</label>
                    <input type="range" id="sector-extraterritorial" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-extraterritorial">0</span>
                </div>
                <div class="slider-container" id="slider-Activities-of-households-as-employers-undifferentiated-goods-and-services-producing-activities-of-households-for-own-use" data-group="Sector">
                    <label for="sector-households">Activities of households as employers; undifferentiated goods- and services-producing activities of households for own use</label>
                    <input type="range" id="sector-households" class=" slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-households">0</span>
                </div>
                <div class="slider-container" id="slider-Administrative-and-support-service-activities" data-group="Sector">
                    <label for="sector-administrative">Administrative and support service activities</label>
                    <input type="range" id="sector-administrative" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-administrative">0</span>
                </div>
                <div class="slider-container" id="slider-Agriculture-forestry-and-fishing" data-group="Sector">
                    <label for="sector-agriculture">Agriculture; forestry and fishing</label>
                    <input type="range" id="sector-agriculture" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-agriculture">0</span>
                </div>
                <div class="slider-container" id="slider-Arts-entertainment-and-recreation" data-group="Sector">
                    <label for="sector-arts">Arts, entertainment and recreation</label>
                    <input type="range" id="sector-arts" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-arts">0</span>
                </div>
                <div class="slider-container" id="slider-Carbon-capture-and-storage" data-group="Sector">
                    <label for="sector-carbon-capture">Carbon capture and storage</label>
                    <input type="range" id="sector-carbon-capture" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-carbon-capture">0</span>
                </div>
                <div class="slider-container" id="slider-Chemical-Industries" data-group="Sector">
                    <label for="sector-chemical">Chemical Industries</label>
                    <input type="range" id="sector-chemical" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-chemical">0</span>
                </div>
                <div class="slider-container" id="slider-Construction" data-group="Sector">
                    <label for="sector-construction">Construction</label>
                    <input type="range" id="sector-construction" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-construction">0</span>
                </div>
                <div class="slider-container" id="slider-Education" data-group="Sector">
                    <label for="sector-education">Education</label>
                    <input type="range" id="sector-education" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-education">0</span>
                </div>
                <div class="slider-container" id="slider-Electricity-gas-steam-and-air-conditioning-supply" data-group="Sector">
                    <label for="sector-electricity">Electricity; gas, steam and air conditioning supply</label>
                    <input type="range" id="sector-electricity" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-electricity">0</span>
                </div>
                <div class="slider-container" id="slider-Energy-Demand" data-group="Sector">
                    <label for="sector-energy-demand">Energy Demand</label>
                    <input type="range" id="sector-energy-demand" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-energy-demand">0</span>
                </div>
                <div class="slider-container" id="slider-Energy-Distribution" data-group="Sector">
                    <label for="sector-energy-distribution">Energy Distribution</label>
                    <input type="range" id="sector-energy-distribution" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-energy-distribution">0</span>
                </div>
                <div class="slider-container" id="slider-Energy-Industries-renewable-non-renewable-sources" data-group="Sector">
                    <label for="sector-energy-industries">Energy Industries (renewable/non-renewable sources)</label>
                    <input type="range" id="sector-energy-industries" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-energy-industries">0</span>
                </div>
                <div class="slider-container" id="slider-Financial-and-insurance-activities" data-group="Sector">
                    <label for="sector-financial">Financial and insurance activities</label>
                    <input type="range" id="sector-financial" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-financial">0</span>
                </div>
                <div class="slider-container" id="slider-Fugitive-emissions-from-fuel-solid-oil-and-gas" data-group="Sector">
                    <label for="sector-fugitive-emissions">Fugitive emissions from fuel (solid, oil and gas)</label>
                    <input type="range" id="sector-fugitive-emissions" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-fugitive-emissions">0</span>
                </div>
                <div class="slider-container" id="slider-Fugitive-emissions-from-the-production-and-consumption-of-halocarbons-and-sulfur-hexafluoride" data-group="Sector">
                    <label for="sector-fugitive-halocarbons">Fugitive emissions from the production and consumption of halocarbons and sulfur hexafluoride</label>
                    <input type="range" id="sector-fugitive-halocarbons" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-fugitive-halocarbons">0</span>
                </div>
                <div class="slider-container" id="slider-Human-health-and-social-work-activities" data-group="Sector">
                    <label for="sector-health">Human health and social work activities</label>
                    <input type="range" id="sector-health" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-health">0</span>
                </div>
                <div class="slider-container" id="slider-Information-and-communication" data-group="Sector">
                    <label for="sector-information">Information and communication</label>
                    <input type="range" id="sector-information" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-information">0</span>
                </div>
                <div class="slider-container" id="slider-Livestock-enteric-fermentation-and-manure-management" data-group="Sector">
                    <label for="sector-livestock">Livestock, enteric fermentation, and manure management</label>
                    <input type="range" id="sector-livestock" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-livestock">0</span>
                </div>
                <div class="slider-container" id="slider-Manufacturing" data-group="Sector">
                    <label for="sector-manufacturing">Manufacturing</label>
                    <input type="range" id="sector-manufacturing" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-manufacturing">0</span>
                </div>
                <div class="slider-container" id="slider-Metal-Production-Metallurgy" data-group="Sector">
                    <label for="sector-metal-production">Metal Production (Metallurgy)</label>
                    <input type="range" id="sector-metal-production" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-metal-production">0</span>
                </div>
                <div class="slider-container" id="slider-Mining-and-quarrying" data-group="Sector">
                    <label for="sector-mining">Mining and quarrying</label>
                    <input type="range" id="sector-mining" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-mining">0</span>
                </div>
                <div class="slider-container" id="slider-Other-service-activities" data-group="Sector">
                    <label for="sector-other-services">Other service activities</label>
                    <input type="range" id="sector-other-services" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-other-services">0</span>
                </div>
                <div class="slider-container" id="slider-Professional-scientific-and-technical-activities" data-group="Sector">
                    <label for="sector-professional">Professional, scientific and technical activities</label>
                    <input type="range" id="sector-professional" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-professional">0</span>
                </div>
                <div class="slider-container" id="slider-Public-administration-and-defence-compulsory-social-security" data-group="Sector">
                    <label for="sector-public">Public administration and defence; compulsory social security</label>
                    <input type="range" id="sector-public" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-public">0</span>
                </div>
                <div class="slider-container" id="slider-Real-estate-activities" data-group="Sector">
                    <label for="sector-real-estate">Real estate activities</label>
                    <input type="range" id="sector-real-estate" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-real-estate">0</span>
                </div>
                <div class="slider-container" id="slider-Solvents-use" data-group="Sector">
                    <label for="sector-solvents">Solvents use</label>
                    <input type="range" id="sector-solvents" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-solvents">0</span>
                </div>
                <div class="slider-container" id="slider-Transportation-and-storage" data-group="Sector">
                    <label for="sector-transportation">Transportation and storage</label>
                    <input type="range" id="sector-transportation" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-transportation">0</span>
                </div>
                <div class="slider-container" id="slider-Waste-handling-and-disposal" data-group="Sector">
                    <label for="sector-waste">Waste handling and disposal</label>
                    <input type="range" id="sector-waste" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-waste">0</span>
                </div>
                <div class="slider-container" id="slider-Water-supply-sewerage-waste-management-and-remediation-activities" data-group="Sector">
                    <label for="sector-water-supply">Water supply; sewerage, waste management and remediation activities</label>
                    <input type="range" id="sector-water-supply" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-water-supply">0</span>
                </div>
                <div class="slider-container" id="slider-Wholesale-and-retail-trade-repair-of-motor-vehicles-and-motorcycles" data-group="Sector">
                    <label for="sector-wholesale">Wholesale and retail trade; repair of motor vehicles and motorcycles</label>
                    <input type="range" id="sector-wholesale" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-wholesale">0</span>
                </div>
                <div class="slider-container" id="slider-Not-elsewhere-classified" data-group="Sector">
                    <label for="sector-not-classified">Not elsewhere classified</label>
                    <input type="range" id="sector-not-classified" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-sector-not-classified">0</span>
                </div>
            </div>
            <div class="coefficient-group">
                <h2>CADT - Location</h2>
                <h3>Location</h3>
                <div class="checkbox-container tooltip">
                    <input type="checkbox" id="country-africa-checkbox">
                    <label for="country-africa-checkbox">Africa</label>
                    <span class="tooltiptext"></span>
                    <span class="count-span"></span>
                </div>
                <div class="checkbox-container tooltip">
                    <input type="checkbox" id="country-asia-checkbox">
                    <label for="country-asia-checkbox">Asia</label>
                    <span class="tooltiptext"></span>
                    <span class="count-span"></span>
                </div>
                <div class="checkbox-container tooltip">
                    <input type="checkbox" id="country-europe-checkbox">
                    <label for="country-europe-checkbox">Europe</label>
                    <span class="tooltiptext"></span>
                    <span class="count-span"></span>
                </div>
                <div class="checkbox-container tooltip">
                    <input type="checkbox" id="country-americas-checkbox">
                    <label for="country-americas-checkbox">Americas</label>
                    <span class="tooltiptext"></span>
                    <span class="count-span"></span>
                </div>
                <div class="checkbox-container tooltip">
                    <input type="checkbox" id="country-oceania-checkbox">
                    <label for="country-oceania-checkbox">Oceania</label>
                    <span class="tooltiptext"></span>
                    <span class="count-span"></span>
                </div>
                <div class="checkbox-container tooltip">
                    <input type="checkbox" id="country-eu-checkbox">
                    <label for="country-eu-checkbox">European Union</label>
                    <span class="tooltiptext"></span>
                    <span class="count-span"></span>
                </div>
                <div class="checkbox-container tooltip">
                    <input type="checkbox" id="country-antarctica-checkbox">
                    <label for="country-antarctica-checkbox">Antarctica</label>
                    <span class="tooltiptext"></span>
                    <span class="count-span"></span>
                </div>
                <div class="checkbox-container tooltip">
                    <input type="checkbox" id="country-not-specified-checkbox">
                    <label for="country-not-specified-checkbox">Not Specified</label>
                    <span class="tooltiptext"></span>
                    <span class="count-span"></span>
                </div>

                <div class="slider-container" id="slider-Africa" data-group="Location">
                    <label for="country-africa">Africa</label>
                    <input type="range" id="country-africa" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-country-africa">0</span>
                </div>
                <div class="slider-container" id="slider-Asia" data-group="Location">
                    <label for="country-asia">Asia</label>
                    <input type="range" id="country-asia" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-country-asia">0</span>
                </div>
                <div class="slider-container" id="slider-Europe" data-group="Location">
                    <label for="country-europe">Europe</label>
                    <input type="range" id="country-europe" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-country-europe">0</span>
                </div>
                <div class="slider-container" id="slider-Americas" data-group="Location">
                    <label for="country-americas">Americas</label>
                    <input type="range" id="country-americas" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-country-americas">0</span>
                </div>
                <div class="slider-container" id="slider-Oceania" data-group="Location">
                    <label for="country-oceania">Oceania</label>
                    <input type="range" id="country-oceania" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-country-oceania">0</span>
                </div>
                <div class="slider-container" id="slider-European-Union" data-group="Location">
                    <label for="country-eu">European Union</label>
                    <input type="range" id="country-eu" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-country-eu">0</span>
                </div>
                <div class="slider-container" id="slider-Antarctica" data-group="Location">
                    <label for="country-antarctica">Antarctica</label>
                    <input type="range" id="country-antarctica" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-country-antarctica">0</span>
                </div>
                <div class="slider-container" id="slider-Not-Specified" data-group="Location">
                    <label for="country-not-specified">Not Specified</label>
                    <input type="range" id="country-not-specified" class="slider" min="-100" max="0" step="0.1" value="0">
                    <span class="slider-value" id="value-country-not-specified">0</span>
                </div>
            </div>
            <div>
                <h2>Order Summary</h2>
                <div class="output">
                    <h3>Final Pricing Equation</h3>
                    <p id="regression-equation"></p>
                    <h3>Carbon Credit Quantity</h3>
                    <p id="quantity-display"></p>
                    <h3>Unit Vintage Year Range</h3>
                    <p id="vintage-year-range-display"></p>
                    <h3>Payment Token</h3>
                    <p id="payment-token-display"></p>
                    <h3>Total Price (Escrow)</h3>
                    <p id="total-price-escrow-display"></p>
                </div>
                <div class="submit-button-container">
                    <button class="submit-button" id="submit-button">Submit Order</button>
                </div>
                <div class="error" id="variation-error"></div>
            </div>
        </div>
        <div>
            <h2>Market Summary</h2>
            <p style="font-size: 2rem; font-weight: bold;">Total Listed Units: <span id="total-listed-units">0</span></p>
            <h2>Tokens List</h2>
            <div class="submit-button-container">
                <button class="submit-button" id="list-all-tokens-button">List All Tokens</button>
            </div>
            <div class="submit-button-container">
                <button class="submit-button" id="list-tokens-button">Refresh Tokens</button>
            </div>
            <div>
                <div>
                    <h2>Filtered Tokens</h2>
                    <table class="tokens-table">
                        <thead>
                            <tr class="main-header">
                                <th colspan="1" class="black-border">Shared Identities</th>
                                <th colspan="5">Trading Platform</th>
                                <th colspan="4" class="green-bg">CADT Preview</th>
                            </tr>
                            <tr class="second-header">
                                <th>Warehouse Unit ID</th>
                                <th>Trading Platform ID</th>
                                <th>Owner</th>
                                <th>Unit Count</th>
                                <th>Price Per Unit</th>
                                <th>Payment Token</th>
                                <th>Registry</th>
                                <th>Sector</th>
                                <th>Location</th>
                                <th>Vintage Year</th>
                            </tr>
                        </thead>
                        <tbody id="filtered-tokens-table-body"></tbody>
                    </table>
              
                    <div class="grey-box">
                        <h2>Matching Tokens</h2>
                        <table class="tokens-table">
                            <thead>
                                <tr class="main-header">
                                    <th colspan="1" class="black-border">Shared Identities</th>
                                    <th colspan="4">Trading Platform</th>
                                    <th colspan="4" class="green-bg">CADT Preview</th>
                                    <th colspan="2" class="orange-bg">Order Result</th>
                                </tr>
                                <tr class="second-header">
                                    <th>Warehouse Unit ID</th>
                                    <th>Trading Platform ID</th>
                                    <th>Owner</th>
                                    <th>Unit Count</th>
                                    <th>Price Per Unit</th>
                                    <th>Registry</th>
                                    <th>Sector</th>
                                    <th>Location</th>
                                    <th>Vintage Year</th>
                                    <th>User Price</th>
                                    <th>Price Difference</th>
                                </tr>
                            </thead>
                            <tbody id="passed-tokens-table-body"></tbody>
                        </table>
                    
                        <div class="order-type-container">
                            <label>Immediate Order Fill Method: </label>
                            <input type="radio" id="fill-by-cheapest" name="fill-method" value="cheapest" checked>
                            <label for="fill-by-cheapest">Fill By Cheapest</label>
                            <input type="radio" id="fill-by-max-value" name="fill-method" value="max-value">
                            <label for="fill-by-max-value">Fill By Max. Value</label>
                        </div>
                    
                        <h2>Immediate Order Fill</h2>
                        <table class="tokens-table">
                            <thead>
                                <tr class="main-header">
                                    <th colspan="1" class="black-border">Shared Identities</th>
                                    <th colspan="4">Trading Platform</th>
                                    <th colspan="4" class="green-bg">CADT Preview</th>
                                    <th colspan="3" class="orange-bg">Order Result</th>
                                </tr>
                                <tr class="second-header">
                                    <th>Warehouse Unit ID</th>
                                    <th>Trading Platform ID</th>
                                    <th>Owner</th>
                                    <th>Unit Count</th>
                                    <th>Price Per Unit</th>
                                    <th>Registry</th>
                                    <th>Sector</th>
                                    <th>Location</th>
                                    <th>Vintage Year</th>
                                    <th>User Price</th>
                                    <th>Price Difference</th>
                                    <th>Fill Unit Count</th>
                                </tr>
                            </thead>
                            <tbody id="immediate-order-fill-table-body"></tbody>
                        </table>
                    
                        <div class="tokens-list" id="immediate-order-fill-summary">
                            <h2>Immediate Order Fill Summary</h2>
                            <p>Total Immediate Order Fill Unit Count: 0</p>
                        </div>
                    </div>
                    <div class="tokens-list" id="order-history-section">
                        <h2>Order History</h2>
                        <div class="submit-button-container">
                            <button class="submit-button" id="list-all-orders-button">List All Orders</button>
                        </div>
                        <table class="tokens-table">
                            <thead>
                                <tr class="main-header">
                                    <th>Order ID</th>
                                    <th>Pricing Equation</th>
                                    <th>Quantity</th>
                                    <th>Vintage Year Range</th>
                                    <th>Payment Token</th>
                                    <th>Escrowed Amount</th>
                                    <th>Filled With</th>
                                </tr>
                            </thead>
                            <tbody id="order-history-table-body"></tbody>
                        </table>
                    </div>
            </div>
        </div>
        <!-- <div class="log-container">
            <h2>Logs</h2>
            <div class="log-box" id="log-box"></div>
        </div> -->
    </div>
    <div id="popup"></div>
</body>

</html>
